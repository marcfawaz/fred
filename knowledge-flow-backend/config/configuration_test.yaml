# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

app:
  name: "Knowledge Flow Backend (Test)"
  base_url: "/knowledge-flow/v1"
  address: "0.0.0.0"
  port: 8111
  log_level: "warning"
  reload: false
  reload_dir: "."
  metrics_enabled: false
  metrics_address: "0.0.0.0"
  metrics_port: 9111
  kpi_process_metrics_interval_sec: 0
  kpi_log_summary_interval_sec: 0.0
  kpi_log_summary_top_n: 0

processing:
  default_profile: fast
  profiles:
    fast:
      use_gpu: false
      generate_summary: false
      process_images: false
      pdf:
        backend: pypdfium2
        images_scale: 1.0
        generate_picture_images: false
        generate_page_images: false
        generate_table_images: false
        do_table_structure: false
        do_ocr: false
      input_processors:
        - suffix: ".pdf"
          class_path: knowledge_flow_backend.core.processors.input.lightweight_markdown_processor.lite_pdf_to_md_processor.LitePdfMarkdownProcessor
        - suffix: ".docx"
          class_path: knowledge_flow_backend.core.processors.input.docx_markdown_processor.docx_markdown_processor.DocxMarkdownProcessor
        - suffix: ".pptx"
          class_path: knowledge_flow_backend.core.processors.input.pptx_markdown_processor.pptx_markdown_processor.PptxMarkdownProcessor
        - suffix: ".csv"
          class_path: knowledge_flow_backend.core.processors.input.csv_tabular_processor.csv_tabular_processor.CsvTabularProcessor
        - suffix: ".txt"
          class_path: knowledge_flow_backend.core.processors.input.text_markdown_processor.text_markdown_processor.TextMarkdownProcessor
        - suffix: ".md"
          class_path: knowledge_flow_backend.core.processors.input.markdown_markdown_processor.markdown_markdown_processor.MarkdownMarkdownProcessor
        - suffix: ".xlsm"
          class_path: knowledge_flow_backend.core.processors.input.pps_tabular_processor.pps_tabular_processor.PpsTabularProcessor
        - suffix: ".jsonl"
          class_path: knowledge_flow_backend.core.processors.input.jsonl.jsonl_markdown_processor.JsonlMarkdownProcessor
    medium:
      use_gpu: false
      generate_summary: false
      process_images: false
      pdf:
        backend: dlparse_v4
        images_scale: 2.0
        generate_picture_images: false
        generate_page_images: false
        generate_table_images: false
        do_table_structure: false
        do_ocr: false
      input_processors:
        - suffix: ".pdf"
          class_path: knowledge_flow_backend.core.processors.input.pdf_markdown_processor.pdf_markdown_processor.PdfMarkdownProcessor
        - suffix: ".docx"
          class_path: knowledge_flow_backend.core.processors.input.docx_markdown_processor.docx_markdown_processor.DocxMarkdownProcessor
        - suffix: ".pptx"
          class_path: knowledge_flow_backend.core.processors.input.pptx_markdown_processor.pptx_markdown_processor.PptxMarkdownProcessor
        - suffix: ".csv"
          class_path: knowledge_flow_backend.core.processors.input.csv_tabular_processor.csv_tabular_processor.CsvTabularProcessor
        - suffix: ".txt"
          class_path: knowledge_flow_backend.core.processors.input.text_markdown_processor.text_markdown_processor.TextMarkdownProcessor
        - suffix: ".md"
          class_path: knowledge_flow_backend.core.processors.input.markdown_markdown_processor.markdown_markdown_processor.MarkdownMarkdownProcessor
        - suffix: ".xlsm"
          class_path: knowledge_flow_backend.core.processors.input.pps_tabular_processor.pps_tabular_processor.PpsTabularProcessor
        - suffix: ".jsonl"
          class_path: knowledge_flow_backend.core.processors.input.jsonl.jsonl_markdown_processor.JsonlMarkdownProcessor
    rich:
      use_gpu: false
      generate_summary: false
      process_images: true
      pdf:
        backend: dlparse_v4
        images_scale: 2.0
        generate_picture_images: true
        generate_page_images: true
        generate_table_images: false
        do_table_structure: true
        do_ocr: true
      input_processors:
        - suffix: ".pdf"
          class_path: knowledge_flow_backend.core.processors.input.pdf_markdown_processor.pdf_markdown_processor.PdfMarkdownProcessor
        - suffix: ".docx"
          class_path: knowledge_flow_backend.core.processors.input.docx_markdown_processor.docx_markdown_processor.DocxMarkdownProcessor
        - suffix: ".pptx"
          class_path: knowledge_flow_backend.core.processors.input.pptx_markdown_processor.pptx_markdown_processor.PptxMarkdownProcessor
        - suffix: ".csv"
          class_path: knowledge_flow_backend.core.processors.input.csv_tabular_processor.csv_tabular_processor.CsvTabularProcessor
        - suffix: ".txt"
          class_path: knowledge_flow_backend.core.processors.input.text_markdown_processor.text_markdown_processor.TextMarkdownProcessor
        - suffix: ".md"
          class_path: knowledge_flow_backend.core.processors.input.markdown_markdown_processor.markdown_markdown_processor.MarkdownMarkdownProcessor
        - suffix: ".xlsm"
          class_path: knowledge_flow_backend.core.processors.input.pps_tabular_processor.pps_tabular_processor.PpsTabularProcessor
        - suffix: ".jsonl"
          class_path: knowledge_flow_backend.core.processors.input.jsonl.jsonl_markdown_processor.JsonlMarkdownProcessor

# Use a no-op output processor for markdown-quality profile tests.
# This avoids embedding/vectorization calls so tests can focus only on
# input conversion quality.
output_processors:
  # Important: output stage runs on the generated preview file extension
  # (typically output.md), not on the original input extension.
  - suffix: ".md"
    class_path: knowledge_flow_backend.core.processors.output.empty_output_processor.EmptyOutputProcessor
  - suffix: ".csv"
    class_path: knowledge_flow_backend.core.processors.output.empty_output_processor.EmptyOutputProcessor
  - suffix: ".duckdb"
    class_path: knowledge_flow_backend.core.processors.output.empty_output_processor.EmptyOutputProcessor

security:
  m2m:
    enabled: false
    client_id: "knowledge-flow"
    realm_url: "http://app-keycloak:8080/realms/app"
  user:
    enabled: false
    client_id: "app"
    realm_url: "http://app-keycloak:8080/realms/app"
  authorized_origins:
    - "http://localhost:5173"
  rebac:
    enabled: false
    type: openfga
    api_url: "http://localhost:9080"

# Keep ingestion synchronous for easier test scripting and deterministic logs.
scheduler:
  enabled: false
  backend: "memory"
  temporal:
    host: "localhost:7233"
    namespace: "default"
    task_queue: "ingestion"
    workflow_id_prefix: "pipeline"
    connect_timeout_seconds: 5

content_storage:
  type: "local"
  root_path: "/app/.fred-test/content-storage"

document_sources:
  fred:
    type: push
    description: "Documents manually uploaded by users"

# Local-safe defaults to avoid requiring OPENAI_API_KEY for startup.
chat_model:
  provider: ollama
  name: qwen2.5:3b-instruct
  settings:
    base_url: http://localhost:11434
    temperature: 0
    max_retries: 0
embedding_model:
  provider: ollama
  name: nomic-embed-text
  settings:
    base_url: http://localhost:11434
    max_retries: 0

# Optional vision model. If absent and rich.process_images=true, the processor
# logs a warning and continues without image descriptions.
# vision_model:
#   provider: ollama
#   name: llava:7b
#   settings:
#     base_url: http://localhost:11434

crossencoder_model:
  name: cross-encoder/ms-marco-MiniLM-L-12-v2
  settings:
    online: false
    local_path: /app/.cache/huggingface

storage:
  postgres:
    sqlite_path: "/app/.fred-test/knowledge-flow.db"
  opensearch:
    host: https://localhost:9200
    secure: true
    verify_certs: false
    username: admin
  catalog_store:
    type: "postgres"
    table: catalog
  prompt_store:
    type: "postgres"
    table: prompts
  resource_store:
    type: "postgres"
    table: resource
  kpi_store:
    type: "log"
    level: "INFO"
  tag_store:
    type: "postgres"
    table: tags
  metadata_store:
    type: "postgres"
    table: metadata
  task_store:
    type: "postgres"
    table: workflow_tasks
    prefix: "sched_"
  vector_store:
    type: in_memory
  tabular_stores:
    base_database:
      type: "sql"
      driver: "duckdb"
      database: "base_database"
      path: "/app/.fred-test/db.duckdb"
      mode: "read_and_write"

mcp:
  reports_enabled: true
  kpi_enabled: true
  tabular_enabled: true
  statistic_enabled: true
  text_enabled: true
  templates_enabled: true
  resources_enabled: true
  opensearch_ops_enabled: false
  neo4j_enabled: false
  filesystem_enabled: true

filesystem:
  type: local
  root: "/app/.fred-test/filesystem"

workspace_layout:
  user_pattern: "users/{user_id}/{key}"
  agent_config_pattern: "agents/{agent_id}/config/{key}"
  agent_user_pattern: "agents/{agent_id}/users/{user_id}/{key}"
